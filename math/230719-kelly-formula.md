---
description: 凯利公式的推导
---

# 凯利公式

假设一次投资获利的概率为 P, 每次获利的 b 元（赔率为 1:b）。那么多次重复最优投资比例 f 应该是

$$ 
f = P - {(1 - P)\over b}
$$
  
那么它的推导过程是什么呢？假设我们有本金 $$ A_0 $$，那么在 k 次投资之后取决于赢钱还是输钱，你的本金会变为 $$A_k+1 = A_k \times (1 + bf) $$ 或者 $$ A_k+1 = A_k \times (1 - f) $$。假设我们总共投资了 N 次，那么这时我们的资金会是

$$ A_N = A_0(1 + bf)^NP(1 - f)^{N(1 - P)} $$
  
所以

$$ \sqrt[N]{A_N \over A_0} = (1 + bf)^P(1 - f)^{1 - P} $$  
  
即为一次投资的平均回报率。我们要求这个数为最大。对两边取对数，

$$ lnF(f) = Pln(1 + bf) + (1 - P)ln(1 - f)$$  
  
对数函数是一个增函数，那么想要让等式的左边最大，那么我们就需要对 f 求导,

$$ {d_{lnF(f)} \over d_{f}}  = {Pb \over 1 + bf} - {1 - P \over 1 - f} = 0 $$  

这样的话我们会得到上面提到的最优投资比例。

这里投资的获利概率 P 是固定的，但是股票投资获利的概率不是固定的，同时每次获利的数值也不是固定的，那么在这种情况下怎么计算每次投资的最优比例 f 呢？

由于股票投资中获利概率 P 不是一个常量，赔率（或者回报率）也不是常量，那我们必然需要用几个假设来界定适用范围。我们假设

1. 投资策略选中的投资组合中的股票回报是符合正态分布的。进一步说这意味着股票回报有固定的均值和方差，现在的均值和方差可以用于计算未来的参数。
2. 回报率指的是扣除了所有损耗的剩余回报。
3. 所有的利润都会被重新用于投资

在这些假设条件下，如果我们把每种策略 i 之间的资金分配标记为$$f_{i}$$, 总共有 N 个策略，即$$f = (f_{1}, f_{2},...,f_{N})$$，则每种策略的最优分配凯利准则为 

$$
f_{i} = u_{i} / \sigma_{i}
$$

其中$$u_{i}$$是超额收益的平均值，$$\sigma_{i}$$是策略的超额收益标准差。 这个公式基本上描述了每种策略应采用的最佳杠杆率。

由于均值和标准差的估算总是受到不确定性的影响，因此在实践中，许多交易者倾向于使用更保守的杠杆机制，如凯利标准除以二，人们亲切地称之为 "半凯利"。凯利标准实际上应被视为使用杠杆的上限，而不是直接的规范。如果不听取这一建议，那么由于策略回报的非高斯性质，直接使用凯利值可能会导致毁灭（即账户净值消失为零）。具体解释请参考 [Money Management via the Kelly Criterion](https://www.quantstart.com/articles/Money-Management-via-the-Kelly-Criterion/)。


# Reference
1. 
2. [THE KELLY CRITERION IN BLACKJACK SPORTS BETTING, AND THE STOCK MARKET](http://www.eecs.harvard.edu/cs286r/courses/fall12/papers/Thorpe_KellyCriterion2007.pdf)