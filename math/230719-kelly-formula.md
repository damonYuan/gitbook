---
description: 凯利公式的推导
---

# 凯利公式

假设一次投资获利的概率为 P, 每次获利的 b 元（赔率为 1:b）。那么多次重复最优投资比例 f 应该是

$$ 
f = P - {(1 - P)\over b}
$$
  
那么它的推导过程是什么呢？假设我们有本金 $$ A_0 $$，那么在 k 次投资之后取决于赢钱还是输钱，你的本金会变为 $$A_k+1 = A_k \times (1 + bf) $$ 或者 $$ A_k+1 = A_k \times (1 - f) $$。假设我们总共投资了 N 次，那么这时我们的资金会是

$$ A_N = A_0(1 + bf)^NP(1 - f)^{N(1 - P)} $$
  
所以

$$ \sqrt[N]{A_N \over A_0} = (1 + bf)^P(1 - f)^{1 - P} $$  
  
即为一次投资的平均回报率。我们要求这个数为最大。对两边取对数，

$$ lnF(f) = Pln(1 + bf) + (1 - P)ln(1 - f)$$  
  
对数函数是一个增函数，那么想要让等式的左边最大，那么我们就需要对 f 求导,

$$ {d_{lnF(f)} \over d_{f}}  = {Pb \over 1 + bf} - {1 - P \over 1 - f} = 0 $$  

这样的话我们会得到上面提到的最优投资比例。

这里投资的获利概率 P 是固定的，但是股票投资获利的概率不是固定的，同时每次获利的数值也不是固定的，那么在这种情况下怎么计算每次投资的最优比例 f 呢？

由于股票投资中获利概率 P 不是一个常量，赔率（或者回报率）也不是常量，那我们必然需要用几个假设来界定适用范围。我们假设

1. 投资策略选中的投资组合中的股票回报是符合正态分布的。进一步说这意味着股票回报有固定的均值和方差，现在的均值和方差可以用于计算未来的参数。
2. 回报率指的是扣除了所有损耗的剩余回报。
3. 所有的利润都会被重新用于投资

TODO: https://github.com/damonYuan/damonyuan.github.io/blob/main/series/quantitative-trading-with-backtrader/2020-10-20-qt-htbyoatb-6.2/2020-10-20-qt-htbyoatb-6.2.md